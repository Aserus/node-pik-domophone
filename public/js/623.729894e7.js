(self["webpackChunkvue_pik_domophone"]=self["webpackChunkvue_pik_domophone"]||[]).push([[623],{9348:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>de});var n=t(3673);const l=(0,n._)("div",{class:"q-table__title"},"Список пользоватей",-1),o={class:"text-right q-pt-md"};function s(e,a,t,s,i,r){const c=(0,n.up)("q-btn"),d=(0,n.up)("q-space"),m=(0,n.up)("q-table"),u=(0,n.up)("dialog-user-add"),p=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(p,{class:"q-pa-md"},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{title:"Список пользователей",rows:e.userList,columns:e.columns,"row-key":"id"},{top:(0,n.w5)((t=>[l,(0,n.Wm)(c,{class:"q-ml-md",round:"",dense:"",icon:"add",color:"primary",onClick:a[0]||(a[0]=a=>e.dialogUserAdd=!0)}),(0,n.Wm)(d)])),_:1},8,["rows","columns"]),(0,n._)("div",o,[(0,n.Wm)(c,{color:"red",size:"sm",label:"Удалить всех пользователей",onClick:e.removeAll},null,8,["onClick"])]),e.dialogUserAdd?((0,n.wg)(),(0,n.j4)(u,{key:0,modelValue:e.dialogUserAdd,"onUpdate:modelValue":a[1]||(a[1]=a=>e.dialogUserAdd=a),onSuccess:e.fetchList},null,8,["modelValue","onSuccess"])):(0,n.kq)("",!0)])),_:1})}var i=t(1959),r=t(5474);function c(e,a,t,l,o,s){const i=(0,n.up)("q-input"),r=(0,n.up)("q-step"),c=(0,n.up)("face-form"),d=(0,n.up)("face-list"),m=(0,n.up)("q-btn"),u=(0,n.up)("q-stepper-navigation"),p=(0,n.up)("q-stepper"),g=(0,n.up)("q-card"),f=(0,n.up)("q-dialog");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(f,{modelValue:e.dialog,"onUpdate:modelValue":a[5]||(a[5]=a=>e.dialog=a),dense:""},{default:(0,n.w5)((()=>[(0,n.Wm)(g,{style:{"max-width":"100%",width:"800px"}},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{modelValue:e.step,"onUpdate:modelValue":a[4]||(a[4]=a=>e.step=a),ref:"stepper",color:"primary",animated:""},{navigation:(0,n.w5)((()=>[(0,n.Wm)(u,{class:"text-right"},{default:(0,n.w5)((()=>[e.step>1?((0,n.wg)(),(0,n.j4)(m,{key:0,class:"q-ml-sm",color:"primary",label:"Назад",flat:"",onClick:a[2]||(a[2]=a=>e.$refs.stepper.previous())})):(0,n.kq)("",!0),(0,n.Wm)(m,{label:2===e.step?"Добавить":"Далее",color:"primary",disabled:2===e.step&&0==e.faceList.length,onClick:a[3]||(a[3]=a=>e.nextStep())},null,8,["label","disabled"])])),_:1})])),default:(0,n.w5)((()=>[(0,n.Wm)(r,{name:1,title:"Информация о пользователе",icon:"info",done:e.step>1},{default:(0,n.w5)((()=>[(0,n.Wm)(i,{filled:"",modelValue:e.userParams.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.userParams.name=a),label:"Введите имя",rules:e.rules.name,"lazy-rules":""},null,8,["modelValue","rules"])])),_:1},8,["done"]),(0,n.Wm)(r,{name:2,title:"Добавление лиц",icon:"photo_camera_back",done:e.step>2},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{onFace:a[1]||(a[1]=a=>e.faceList.push(a))}),(0,n.Wm)(d,{list:e.faceList,onRemove:e.removeFace},null,8,["list","onRemove"])])),_:1},8,["done"])])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"])])}var d=t(515),m=t.n(d);t(71);function u(e,a,t,l,o,s){const i=(0,n.up)("q-tab"),r=(0,n.up)("q-tabs"),c=(0,n.up)("frame-input"),d=(0,n.up)("q-tab-panel"),m=(0,n.up)("frame-webcamera"),u=(0,n.up)("q-tab-panels"),p=(0,n.up)("q-spinner-gears"),g=(0,n.up)("q-inner-loading");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(r,{class:"text-grey",modelValue:e.tab,"onUpdate:modelValue":a[0]||(a[0]=a=>e.tab=a),dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:(0,n.w5)((()=>[(0,n.Wm)(i,{name:"file",icon:"description"}),(0,n.Wm)(i,{name:"webcamera",icon:"videocam"})])),_:1},8,["modelValue"]),(0,n.Wm)(u,{modelValue:e.tab,"onUpdate:modelValue":a[1]||(a[1]=a=>e.tab=a),animated:""},{default:(0,n.w5)((()=>[(0,n.Wm)(d,{class:"q-px-none",name:"file"},{default:(0,n.w5)((()=>[(0,n.Wm)(c,{onFrame:e.onFrame},null,8,["onFrame"])])),_:1}),(0,n.Wm)(d,{class:"q-px-none",name:"webcamera"},{default:(0,n.w5)((()=>[(0,n.Wm)(m,{onFrame:e.onFrame},null,8,["onFrame"])])),_:1})])),_:1},8,["modelValue"]),(0,n.Wm)(g,{showing:e.isLoading},{default:(0,n.w5)((()=>[(0,n.Wm)(p,{size:"50px",color:"primary"})])),_:1},8,["showing"])])}var p=t(6702);const g={class:"face-image"},f=["src"],v=(0,n._)("canvas",{class:"face-image-overlay"},null,-1);function w(e,a,t,l,o,s){return(0,n.wg)(),(0,n.iD)("div",g,[(0,n._)("img",{class:"face-image-img",src:e.src},null,8,f),v])}const h=(0,n.aZ)({props:{src:String},setup(e){}});h.render=w;const b=h;function q(e,a,t,l,o,s){const i=(0,n.up)("q-icon"),r=(0,n.up)("q-file");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(r,{outlined:"",label:"Укажите фото",required:"",onChange:e.onChange},{append:(0,n.w5)((()=>[(0,n.Wm)(i,{name:"attach_file"})])),_:1},8,["onChange"])])}function y(e,a){const t=1e3,n=1e3;return(e>t||a>n)&&(e>a?(a=a*t/e,e=t):(e=e*n/a,a=n)),{width:e,height:a}}const _=(0,n.aZ)({setup(e,{emit:a}){return{onChange(e){if(0==e.target.files.length)return;const t=e.target.files[0],n=new FileReader;n.readAsDataURL(t),n.onload=e=>{if(e.target.readyState==FileReader.DONE){const t=new Image;t.onload=()=>{const e=document.createElement("canvas"),{width:n,height:l}=y(t.width,t.height);e.width=n,e.height=l,e.getContext("2d").drawImage(t,0,0,n,l),a("frame",e)},t.src=e.target.result}}}}}});var F=t(4974),W=t(4554),Z=t(7518),k=t.n(Z);_.render=q;const C=_;function V(e,a,t,l,o,s){return(0,n.wg)(),(0,n.iD)("div",null,[(0,n._)("video",{class:"webcamera-video",ref:"webcamera",onClick:a[0]||(a[0]=(...a)=>e.captureFrame&&e.captureFrame(...a))},null,512)])}k()(_,"components",{QFile:F.Z,QIcon:W.Z});const D=(0,n.aZ)({setup(e,{emit:a}){const t=(0,i.iH)(null);let l;const o=async()=>{s(),l=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1}),t.value.srcObject=l,t.value.onloadedmetadata=()=>t.value.play()},s=()=>{l&&(l.getTracks().forEach((e=>e.stop())),l=null)};(0,n.bv)((()=>o())),(0,n.Jd)((()=>s()));const r=()=>{const e=document.createElement("canvas"),n=e.getContext("2d"),l=t.value;e.width=l.videoWidth,e.height=l.videoHeight,n.drawImage(l,0,0,l.videoWidth,l.videoHeight),a("frame",e)};return{webcamera:t,captureFrame:r}}});D.render=V,D.__scopeId="data-v-9703f908";const Q=D;let U=!1,L="/model";const x=.2,H=5;let I;const S=async()=>{U||(await p.tf.setBackend("webgl"),await p.tf.enableProdMode(),await p.tf.ENV.set("DEBUG",!1),await p.tf.ready(),await p.qB.ssdMobilenetv1.load(L),await p.qB.faceLandmark68Net.load(L),await p.qB.faceRecognitionNet.load(L),I=new p.d7({minConfidence:x,maxResults:H}),U=!0)},A=(0,n.aZ)({components:{FaceImage:b,FrameInput:C,FrameWebcamera:Q},computed:{},setup(e,{emit:a}){const t=(0,i.iH)(!1),n=(0,i.iH)("file"),l=async e=>{t.value=!0;try{await S();const n=await p.bd(e,I).withFaceLandmarks().withFaceDescriptor();n&&a("face",{img:e,detection:n})}catch(n){console.log("err faceapi",n)}finally{t.value=!1}};return{isLoading:t,tab:n,onFrame:l}}});var P=t(7547),R=t(3269),B=t(5906),E=t(6602),T=t(6941),N=t(6394);A.render=u;const j=A;k()(A,"components",{QTabs:P.Z,QTab:R.Z,QTabPanels:B.Z,QTabPanel:E.Z,QInnerLoading:T.Z,QSpinnerGears:N.Z});const O={class:"face-list flex q-gutter-xs"},M=["onClick"];function z(e,a,t,l,o,s){const i=(0,n.up)("q-img");return(0,n.wg)(),(0,n.iD)("div",O,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.listCanvas,((a,t)=>((0,n.wg)(),(0,n.iD)("div",{class:"face-list-item col col-md-auto",onClick:a=>e.removeItem(t)},[(0,n.Wm)(i,{class:"face-list-item-img",src:a.img.toDataURL()},null,8,["src"])],8,M)))),256))])}const G=(0,n.aZ)({props:{list:Array},computed:{listCanvas(){return this.list}},setup(e,{emit:a}){return{removeItem(e){a("remove",e)}}}});var J=t(4027);G.render=z;const K=G;k()(G,"components",{QImg:J.Z});const Y=(0,n.aZ)({components:{FaceForm:j,FaceImage:b,FaceList:K},props:{modelValue:Boolean},setup(e,{emit:a}){const t=(0,i.iH)(1),n=(0,i.iH)([]),l=(0,i.iH)({name:null}),o=()=>{l.value.name=null,n.value=[]},s=(0,i.Fl)({get:()=>e.modelValue,set:e=>a("update:modelValue",e)}),c=async()=>{if(2==t.value){const e=n.value.map((e=>{const a=[...e.detection.descriptor],t=e.img.toDataURL();return console.log(e),{img:t,descriptor:a}})),t=m()(m()({},l.value),{},{faces:e});await r.api.post("/users",t),o(),s.value=!1,a("success")}else t.value++},d=e=>{n.value.splice(e,1)};return{dialog:s,faceList:n,step:t,userParams:l,rules:{name:[e=>e&&e.length>0||"Please type something"]},nextStep:c,resetForm:o,removeFace:d}}});var $=t(6778),X=t(151),ee=t(3518),ae=t(4340),te=t(4689),ne=t(118),le=t(4607);Y.render=c;const oe=Y;k()(Y,"components",{QDialog:$.Z,QCard:X.Z,QStepper:ee.Z,QStep:ae.Z,QInput:te.Z,QStepperNavigation:ne.Z,QBtn:le.Z});const se=(0,n.aZ)({components:{DialogUserAdd:oe},computed:{},setup(){const e=(0,i.iH)([]),a=(0,i.iH)(!1),t=(0,i.iH)(null),l=(0,i.iH)({name:null,photo:[]}),o=[{name:"id",align:"left",label:"id",field:"id",sortable:!0},{name:"name",align:"left",label:"name",field:"name",sortable:!0}],s=async()=>{const{data:a}=await r.api.get("/users");e.value=a.list},c=async()=>{const e=confirm("Удалить все пользователей?");if(!e)return;const{data:a}=await r.api.delete("/users");await s()},d=()=>{l.value.name=null,l.value.photo=[],t.value=null};(0,n.bv)((()=>{s()}));const m={name:[e=>e&&e.length>0||"Please type something"]};return{userParams:l,rules:m,userList:e,faceFile:t,columns:o,dialogUserAdd:a,removeAll:c,fetchList:s,resetForm:d,async onSubmit(){const e=new FormData;e.append("photo",l.value.photo),e.append("name",l.value.name),await r.api.post("/users",e,{headers:{"Content-Type":"multipart/form-data"}}),d(),s()}}}});var ie=t(4379),re=t(8415),ce=t(2025);se.render=s;const de=se;k()(se,"components",{QPage:ie.Z,QTable:re.Z,QBtn:le.Z,QSpace:ce.Z})},6741:e=>{function a(e){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}a.keys=()=>[],a.resolve=a,a.id=6741,e.exports=a}}]);