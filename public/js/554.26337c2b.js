"use strict";(self["webpackChunkvue_pik_domophone"]=self["webpackChunkvue_pik_domophone"]||[]).push([[554],{8554:(e,t,c)=>{c.r(t),c.d(t,{default:()=>y});var o=c(3673);const s={class:"device-list q-pa-md row items-start q-gutter-md"};function n(e,t,c,n,i,a){const l=(0,o.up)("video-socket"),d=(0,o.up)("q-page");return(0,o.wg)(),(0,o.j4)(d,null,{default:(0,o.w5)((()=>[(0,o._)("div",s,[e.activeItem?((0,o.wg)(),(0,o.j4)(l,{key:0,class:"device-item active",item:e.activeItem,socket:e.socket,onClick:t[0]||(t[0]=t=>e.onClickItem(null))},null,8,["item","socket"])):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:1},(0,o.Ko)(e.deviceList,(t=>((0,o.wg)(),(0,o.j4)(l,{class:"device-item",key:t.deviceId,item:t,socket:e.socket,onClick:c=>e.onClickItem(t)},null,8,["item","socket","onClick"])))),128))])])),_:1})}c(71);var i=c(1959),a=c(4773),l=c(2323);const d={class:"device-video",ref:"canvasVideo"},v={class:"device-overlay",ref:"canvasOverlay"},u={class:"device-title text-subtitle2"};function r(e,t,c,s,n,i){const a=(0,o.up)("q-card");return(0,o.wg)(),(0,o.j4)(a,{class:"my-card device"},{default:(0,o.w5)((()=>[(0,o._)("canvas",d,null,512),(0,o._)("canvas",v,null,512),(0,o._)("div",u,(0,l.zw)(e.item.title),1)])),_:1})}const m=640,k=360,g=(0,o.aZ)({name:"SocketVideo",props:{item:Object,socket:Object},setup(e){const t=(0,i.iH)(null),c=(0,i.iH)(null),s=(t,c)=>{e.socket.on(`${e.item.deviceId}.${t}`,c)};return(0,o.bv)((()=>{t.value.width=m,t.value.height=k,c.value.width=m,c.value.height=k;const e=t.value.getContext("2d"),o=c.value.getContext("2d");o.strokeStyle="#33ff00",console.log("ready");const n=new Image;function i(){o.clearRect(0,0,c.value.width,c.value.height)}s("data",(t=>{const c="data:image/jpeg;base64,"+t;n.src=c;const o=new Image;o.src=c,o.onload=function(){e.drawImage(o,0,0)}}));let a=null;s("detections",(e=>{i();const t=JSON.parse(e);console.log("detections",t),t.forEach((e=>{o.strokeRect(e._x,e._y,e._width,e._height)})),clearTimeout(a),a=setTimeout((()=>i()),3e3)}))})),{canvasVideo:t,canvasOverlay:c,socketOn:s}}});var h=c(151),p=c(4027),I=c(7518),w=c.n(I);g.render=r;const f=g;w()(g,"components",{QCard:h.Z,QImg:p.Z});const _=(0,o.aZ)({name:"PageIndex",components:{VideoSocket:f},computed:{deviceAssoc(){const e=new Map;return this.deviceList.forEach((t=>e.set(t.deviceId,t))),e},activeItem(){return this.activeItemId?this.deviceAssoc.get(this.activeItemId):null}},setup(){let e="";const t=(0,a.ZP)(e),c=(0,i.iH)([]),s=(0,i.iH)(null);t.on("devices",(e=>c.value=e));const n=e=>{console.log("click",e,e?e.deviceId:null),s.value=e?e.deviceId:null};return(0,o.Jd)((()=>{t.disconnect(),t.close()})),{socket:t,deviceList:c,activeItemId:s,onClickItem:n}}});var C=c(4379);_.render=n;const y=_;w()(_,"components",{QPage:C.Z})}}]);