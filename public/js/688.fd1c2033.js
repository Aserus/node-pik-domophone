"use strict";(self["webpackChunkvue_pik_domophone"]=self["webpackChunkvue_pik_domophone"]||[]).push([[688],{8688:(e,t,l)=>{l.r(t),l.d(t,{default:()=>$});var i=l(3673);const o={class:"text-right q-pr-md q-py-md"},n={class:"device-list row items-start"};function s(e,t,l,s,c,a){const u=(0,i.up)("q-btn-toggle"),r=(0,i.up)("q-toggle"),d=(0,i.up)("intercom-item"),m=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(m,null,{default:(0,i.w5)((()=>[(0,i._)("div",o,[(0,i.Wm)(u,{modelValue:e.listView,"onUpdate:modelValue":t[0]||(t[0]=t=>e.listView=t),"toggle-color":"primary",options:e.listViewOptions,size:"sm"},null,8,["modelValue","options"]),(0,i.Wm)(r,{class:"q-ml-md",modelValue:e.onlyWebcams,"onUpdate:modelValue":t[1]||(t[1]=t=>e.onlyWebcams=t),color:"green",label:"Только камеры"},null,8,["modelValue"])]),(0,i._)("div",n,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.intercomListFiltered,(e=>((0,i.wg)(),(0,i.iD)("div",{class:"col-12 col-md-4 q-pa-md",key:e.id},[(0,i.Wm)(d,{item:e},null,8,["item"])])))),128))])])),_:1})}var c=l(1959),a=l(2323);const u={key:0,class:"device-cover"},r={class:"device-canvas",ref:"canvas"},d={class:"device-video",ref:"canvasVideo"},m={class:"device-overlay",ref:"canvasOverlay"},v={class:"btn-device-fullscreen"},g={class:"device-title text-subtitle2"},p={class:"text-h6"};function h(e,t,l,o,n,s){const c=(0,i.up)("q-img"),h=(0,i.up)("q-btn"),w=(0,i.up)("q-space"),f=(0,i.up)("q-card-section"),k=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)(k,{class:"my-card device"},{default:(0,i.w5)((()=>[e.hasVideo?((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(c,{class:"device-cover-img",src:e.item.photo_url,ratio:16/9},null,8,["src"]),(0,i._)("div",r,[(0,i._)("canvas",d,null,512),(0,i._)("canvas",m,null,512)],512),(0,i._)("div",v,[(0,i.Wm)(h,{icon:"fullscreen",color:"white","text-color":"black",dense:"",round:"",onClick:e.fullscreenVideo},null,8,["onClick"])])])):(0,i.kq)("",!0),(0,i._)("div",g,(0,a.zw)(e.item.title),1),(0,i.Wm)(f,{class:"flex"},{default:(0,i.w5)((()=>[(0,i._)("div",p,(0,a.zw)(e.item.renamed_name||e.item.human_name),1),(0,i.Wm)(w),(0,i.Wm)(h,{round:"",icon:"lock",onClick:e.unclokItem,dense:""},null,8,["onClick"])])),_:1})])),_:1})}l(71);var w=l(5474),f=l(7083),k=l(4773);const _=`${window.location.protocol}//${window.location.host}`,b=(0,k.ZP)(_);(0,f.xr)((({app:e})=>{e.config.globalProperties.$socket=b}));async function y(e){const t=["requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen"];for(let l of t)if(e[l])return e[l]();return!1}const q=(0,i.aZ)({name:"IntercomItem",props:{item:Object},computed:{hasVideo(){return!!this.item.video}},setup(e){const t=(0,c.iH)(null),l=(0,c.iH)(null),o=(0,c.iH)(null),n=(0,c.iH)(null),s=async()=>{const{data:t}=await w.api.post(`/intercoms/${e.item.id}/unlock`);console.log(t)},a=(t,l)=>{b.on(`intercom.${e.item.id}.${t}`,l)},u=()=>{if(!e.item.video)return;console.log(t.value),t.value.width=1e3,t.value.height=1e3;let i=t.value.getContext("2d"),o=l.value.getContext("2d");const s=e=>{n.value={width:e.width,height:e.height},t.value.width=n.value.width,t.value.height=n.value.height,l.value.width=n.value.width,l.value.height=n.value.height,i=t.value.getContext("2d"),o=l.value.getContext("2d")},c=new Image;function u(){l.value&&(o.clearRect(0,0,l.value.width,l.value.height),o.strokeStyle="#33ff00")}a("data",(e=>{const t="data:image/jpeg;base64,"+e;c.src=t;const l=new Image;l.src=t,l.onload=function(){n.value||s(l),i.drawImage(l,0,0)}}));let r=null;a("detections",(e=>{u();const t=JSON.parse(e);console.log("detections",t),t.forEach((e=>{o.strokeStyle="#33ff00",o.strokeRect(e._x,e._y,e._width,e._height)})),clearTimeout(r),r=setTimeout((()=>u()),3e3)}))};(0,i.bv)((()=>{u()})),(0,i.Jd)((()=>{}));const r=()=>{const e=o.value;y(e)};return{canvas:o,canvasVideo:t,canvasOverlay:l,socketOn:a,unclokItem:s,fullscreenVideo:r}}});var V=l(151),x=l(4027),C=l(4607),W=l(5589),I=l(2025),Z=l(7518),H=l.n(Z);q.render=h;const Q=q;H()(q,"components",{QCard:V.Z,QImg:x.Z,QBtn:C.Z,QCardSection:W.Z,QSpace:I.Z});const O=(0,i.aZ)({name:"PageIndex",components:{IntercomItem:Q},computed:{intercomListFiltered(){if(!this.onlyWebcams)return this.intercomList;const e=this.intercomList.filter((e=>!!e.video));return e}},setup(){const e=(0,c.iH)([]),t=(0,c.iH)(!1),l=(0,c.iH)("list"),o=[{icon:"list",value:"list"},{icon:"grid_view",value:"grid"}],n=async()=>{const{data:t}=await w.api.get("/intercoms");e.value=t.list};return(0,i.bv)((()=>{n()})),{onlyWebcams:t,intercomList:e,fetchList:n,listView:l,listViewOptions:o}}});var F=l(4379),L=l(8761),S=l(8886);O.render=s;const $=O;H()(O,"components",{QPage:F.Z,QBtnToggle:L.Z,QToggle:S.Z})}}]);